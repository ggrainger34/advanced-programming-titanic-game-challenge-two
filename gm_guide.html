<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM Guide - The Temporal Rift on the Titanic</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 40px;
        }
        
        h1 {
            font-size: 2.2em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        h2 {
            font-size: 1.8em;
            color: #764ba2;
            margin: 30px 0 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #764ba2;
        }
        
        h3 {
            font-size: 1.4em;
            color: #555;
            margin: 20px 0 10px;
        }
        
        h4 {
            font-size: 1.2em;
            color: #666;
            margin: 15px 0 8px;
        }
        
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
        
        strong {
            color: #667eea;
            font-weight: 600;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            color: #d63384;
        }
        
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
            border-radius: 0;
        }
        
        blockquote {
            border-left: 4px solid #667eea;
            padding-left: 20px;
            margin: 20px 0;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 5px;
            font-style: italic;
            color: #555;
        }
        
        hr {
            border: none;
            height: 3px;
            background: linear-gradient(to right, #667eea, #764ba2);
            margin: 30px 0;
            border-radius: 2px;
        }
        
        ul {
            margin: 15px 0 15px 30px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        .card {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }
        
        .gm-hint {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .answer-box {
            background: #d1ecf1;
            border-left: 4px solid #0dcaf0;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .chart-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .chart-container img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        .answer-reveal {
            margin: 20px 0;
        }
        
        .reveal-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        
        .reveal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }
        
        .reveal-btn:active {
            transform: translateY(0);
        }
        
        .answer-content {
            background: #fff9e6 !important;
            color: #000000 !important;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            animation: fadeIn 0.5s ease-in;
            font-weight: 500;
        }
        
        .answer-content strong {
            color: #d63384 !important;
            font-weight: bold;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .print-btn {
            background: white;
            color: #667eea;
            border: 2px solid white;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .print-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .print-btn:active {
            transform: translateY(0);
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .print-btn {
                display: none !important;
            }
            
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            
            .header {
                page-break-after: avoid;
            }
            
            h1, h2, h3 {
                page-break-after: avoid;
            }
            
            pre {
                page-break-inside: avoid;
            }
            
            blockquote {
                page-break-inside: avoid;
            }
            
            /* Reveal all answers in print */
            .answer-content {
                display: block !important;
            }
            
            .reveal-btn {
                display: none !important;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            h2 {
                font-size: 1.5em;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="guide-container">
        <div class="header">
            <h1>ðŸŽ® GM Guide</h1>
            <p style="font-size: 1.2em; margin-top: 10px;">The Temporal Rift on the Titanic</p>
            <button onclick="captureScreenshot()" class="print-btn" id="screenshot-btn">ðŸ“¸ Capture Full Page</button>
        </div>
        <div class="content">
            <h1>The Temporal Rift on the Titanic: GM Guide</h1>

<strong>Player Role:</strong> You are a team of time travelers.
<strong>Final Goal:</strong> Before the ship sinks, find 5 missing 'temporal coordinate fragments'.

<hr> 
<h2>Challenge 1: Purser's Office (Find the Anomaly)</h2>

<strong>Story:</strong> You've just boarded and been caught as stowaways. On the desk is a stack of passenger registration cards. You must identify the 'forged' card among them.

<strong>Task:</strong> Out of the following 6 passenger cards, which one is statistically impossible?

<div class="chart-container"><img src="hint\challenge_1_boxplot.png" alt="Box Plot" style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.1);"></div>

<h3>Passenger Cards (Show to Players)</h3>

<strong>Card 1</strong>
<pre><code>
name: Holverson, Mrs. Alexander Oskar (Mary Aline Towner)
Pclass: 1
Age: 35.0
Sex: female
Fare: 52.0
Embarked: S
</code></pre>
<strong>Card 2</strong>
<pre><code>
name: Duff Gordon, Lady. (Lucille Christiana Sutherland) ("Mrs Morgan")
Pclass: 1
Age: 48.0
Sex: female
Fare: 39.6
Embarked: C
</code></pre>
<strong>Card 3</strong>
<pre><code>
name: Elsbury, Mr. William James
Pclass: 3
Age: 47.0
Sex: male
Fare: 7.25
Embarked: S
</code></pre>
<strong>Card 4</strong>
<pre><code>
name: Andersson, Miss. Erna Alexandra
Pclass: 3
Age: 17.0
Sex: female
Fare: 7.92
Embarked: S
</code></pre>
<strong>Card 5</strong>
<pre><code>
name: Sage, Mr. Douglas Bullen
Pclass: 1
Age: nan
Sex: male
Fare: 2.87
Embarked: S
</code></pre>
<strong>Card 6</strong>
<pre><code>
name: Hampe, Mr. Leon
Pclass: 3
Age: 20.0
Sex: male
Fare: 9.5
Embarked: S
</code></pre>

<hr>
<h3>GM Guide</h3>

<blockquote><strong>Hint:</strong> GM Hint: Refer to the box plot above. The forged card has a fare that doesn't match its class - either much higher or much lower than typical for that class. Players should compare each card's fare with the distribution shown in the chart for that card's class.</blockquote>
<blockquote><strong>Answer:</strong> <div class="answer-reveal"><button class="reveal-btn" onclick="toggleAnswer('3409ddb4')">Click to Reveal Answer</button><div class="answer-content" id="answer-3409ddb4" style="display:none;">The forged card: 1st class (Pclass=1) but paying Â£2.87, which is much lower than typical 1st class fares (Â£5.00-512.33). <strong>(In this game, this card is Card 5)</strong></div></div></blockquote>
<blockquote><strong>Obtain:</strong> <strong>Temporal Coordinate Fragment 1</strong> hidden under the forged card.</blockquote>

<hr>
<h2>Decipher the Lifeboat Code</h2>

<strong>Story:</strong> The lifeboat lock requires a 4-digit code based on passengers' survival predictions.

<strong>Task:</strong> Predict which of the 4 passengers survived (1) or perished (0). Use the survival clues provided.

<div class="chart-container"><img src="hint/challenge_3_sex_pclass.png" alt="Hint Chart 1" style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.1);"></div>

<div class="chart-container"><img src="hint/challenge_3_age_group.png" alt="Hint Chart 2" style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.1);"></div>

<h3>Passenger Cards (Show to Players)</h3>

<strong>Card 1</strong>
<pre><code>
Name: Palsson, Mrs. Nils (Alma Cornelia Berglund)
Pclass: 3
Age: 29
Sex: female
Fare: 21.07
Embarked: S
</code></pre>
<strong>Card 2</strong>
<pre><code>
Name: Brown, Miss. Amelia "Mildred"
Pclass: 2
Age: 24
Sex: female
Fare: 13.0
Embarked: S
</code></pre>
<strong>Card 3</strong>
<pre><code>
Name: Reuchlin, Jonkheer. John George
Pclass: 1
Age: 38
Sex: male
Fare: 0.0
Embarked: S
</code></pre>
<strong>Card 4</strong>
<pre><code>
Name: Laleff, Mr. Kristo
Pclass: 3
Age: 28
Sex: male
Fare: 7.9
Embarked: S
</code></pre>

<hr>
<h3>GM Guide</h3>

<blockquote><strong>Hint:</strong> Use the survival charts above to infer the 4-digit lifeboat code.</blockquote>
<blockquote><strong>Answer:</strong> <div class="answer-reveal"><button class="reveal-btn" onclick="toggleAnswer('3b9e3127')">Click to Reveal Answer</button><div class="answer-content" id="answer-3b9e3127" style="display:none;">0100</div></div></blockquote>
<blockquote><strong>Obtain:</strong> <strong>Temporal Coordinate Fragment 3</strong> hidden within the lifeboat control panel.</blockquote>

<hr>
<h2>Letters from a Stowaway</h2>

<strong>Story:</strong> 
    
    The Captain has called you and your group to the deck of the ship with an 
    urgent mission. Telegrams have been intercepted from the ship's Marconi machine
    and it appears there is a stowaway on board! Unfortunately, the dastardly 
    stowaway has managed to scramble one of the telegrams using a mysterious code. 
    The Captain has created a list of 10 suspects. Can you decipher the letter and
    obtain the identity of the suspect before they get away?!

<strong>Task:</strong> Decode the encrypted letter and select the name from the list of suspects.

<h3>Letters from the Stowaway </h3>

<strong>Plaintext Letter</strong><pre><code>   
R.M.S. TITANIC  
MARCONI WIRELESS SERVICE  
APRIL 12, 1912
To Mr. David Smith
Good afternoon, I have snuck aboard this mighty vessel. 
Now time to implement my darstardly plan!
Yours Sincerely,

A Guest of the Deep
</code></pre>
<strong>Encrypted Letter</strong><pre><code>
c.p.x. mkmuhkr  
pucrshk qkctntxx xtcfkrt  
ulckn 12, 1912
pi xtrctm unkux kx pc vuptx pscuh

u aytxm sb met dttl
</code></pre>
<h3>Possible suspects </h3>

<hr>
<h2>Game End</h2>

<p>Congratulations! You've collected all 5 coordinate fragments, restarted the time machine, and successfully escaped from 1912 at the moment the Titanic sank.</p>
        </div>
    </div>
    
    <script>
    function toggleAnswer(id) {
        const answerDiv = document.getElementById('answer-' + id);
        const btn = event.target;
        
        if (answerDiv.style.display === 'none' || answerDiv.style.display === '') {
            answerDiv.style.display = 'block';
            btn.textContent = 'Hide Answer';
            btn.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
        } else {
            answerDiv.style.display = 'none';
            btn.textContent = 'Click to Reveal Answer';
            btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        }
    }
    
    async function captureScreenshot() {
        const btn = document.getElementById('screenshot-btn');
        const container = document.getElementById('guide-container');
        
        // Get all answer elements and buttons
        const allAnswers = document.querySelectorAll('.answer-content');
        const allButtons = document.querySelectorAll('.reveal-btn');
        
        // Save original states
        const originalAnswerStates = Array.from(allAnswers).map(el => el.style.display);
        const originalButtonStates = Array.from(allButtons).map(el => el.style.display);
        
        // Show all answers temporarily for screenshot with better visibility
        allAnswers.forEach(el => {
            el.style.display = 'block';
            el.style.opacity = '1';
            el.style.visibility = 'visible';
            el.style.setProperty('background', '#fff9e6', 'important');
            el.style.setProperty('color', '#000000', 'important');
            el.style.setProperty('border-left', '4px solid #ffc107', 'important');
            el.style.setProperty('border', '1px solid #ffc107', 'important');
        });
        allButtons.forEach(el => {
            el.style.display = 'none';
            el.style.opacity = '1';
        });
        
        // Change button text
        btn.textContent = 'ðŸ“¸ Capturing...';
        btn.disabled = true;
        
        // Force browser to render changes (longer wait for better rendering)
        await new Promise(resolve => setTimeout(resolve, 500));
        
        try {
            // Use html2canvas to capture the entire container with better options
            const canvas = await html2canvas(container, {
                backgroundColor: null,
                scale: 2,  // Higher quality
                useCORS: true,
                logging: false,
                allowTaint: false,
                removeContainer: false,
                onclone: function(clonedDoc) {
                    // Force all answer content to be visible in the clone with VERY visible colors
                    const clonedAnswers = clonedDoc.querySelectorAll('.answer-content');
                    clonedAnswers.forEach(el => {
                        // Use very visible background and text colors
                        el.style.cssText = 'display: block !important; ' +
                                         'opacity: 1 !important; ' +
                                         'visibility: visible !important; ' +
                                         'background-color: #fef3c7 !important; ' +
                                         'color: #000000 !important; ' +
                                         'border: 2px solid #f59e0b !important; ' +
                                         'font-weight: 600 !important; ' +
                                         'padding: 15px !important; ' +
                                         'margin: 15px 0 !important; ' +
                                         'border-left: 4px solid #f59e0b !important;';
                        
                        // Get all text inside and make it black
                        const walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT);
                        let node;
                        while (node = walker.nextNode()) {
                            node.nodeValue = node.nodeValue;
                        }
                    });
                }
            });
            
            // Convert canvas to image and download
            const imgData = canvas.toDataURL('image/png', 1.0);
            const link = document.createElement('a');
            link.download = 'gm_guide_full_page.png';
            link.href = imgData;
            link.click();
            
            btn.textContent = 'âœ… Saved!';
            
            // Restore original states
            setTimeout(() => {
                allAnswers.forEach((el, idx) => {
                    el.style.display = originalAnswerStates[idx] || 'none';
                    el.style.opacity = '';
                    el.style.visibility = '';
                });
                allButtons.forEach((el, idx) => {
                    el.style.display = originalButtonStates[idx] || 'block';
                    el.style.opacity = '';
                });
                
                btn.textContent = 'ðŸ“¸ Capture Full Page';
                btn.disabled = false;
            }, 2000);
            
        } catch (error) {
            console.error('Screenshot failed:', error);
            btn.textContent = 'âŒ Error - Retry';
            btn.disabled = false;
            
            // Restore original states on error
            allAnswers.forEach((el, idx) => {
                el.style.display = originalAnswerStates[idx] || 'none';
                el.style.opacity = '';
                el.style.visibility = '';
            });
            allButtons.forEach((el, idx) => {
                el.style.display = originalButtonStates[idx] || 'block';
                el.style.opacity = '';
            });
        }
    }
    </script>
</body>
</html>